<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>PIP UI Management Tool</title>
  <meta name="description" content="PIP UI Management Tool">
  <meta name="author" content="Sam Sultan">

  <!-- JQuery -->
  <script src="{{ url_for('static', filename='jquery-3.5.1.min.js') }}"></script>
  <!-- End of JQuery -->

  <!-- Bootstrap -->
  <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.css') }}" />
  <script src="{{ url_for('static', filename='bootstrap.js') }}"></script>
  <!-- End of Bootstrap -->

  <style type="text/css">
  	
  	body{
  		margin: 4em;
  	}

  </style>

</head>

<body>
  
	<div class="container-fluid text-center"> 

		<div class="row content">

			<div class="col-sm-2 sidenav">

			</div>

			<div class="col-sm-8 text-left"> 
				
				<table class="table table-striped">
					<thead>
					  <tr>
					    <th>Package Name</th>
					    <th>Version</th>
					    <th></th>
					  </tr>
					</thead>
					<tbody>
					  
					  {% for package in packages %}
						  <tr id="package-id-{{ package.name }}" class="package-row">
						    <td>{{ package.name }}</td>
						    <td>{{ package.version }}</td>
						    <td>
						    	<button class="btn btn-danger float-right remove" data-package="{{ package.name }}" data-id="package-id-{{ package.name }}">remove</button>
						    </td>
						  </tr>
					  {% endfor %}

					</tbody>
				</table>

			</div>

			<div class="col-sm-2 sidenav">


			</div>

		</div>

	</div>


	<!-- Modal -->
	<div class="modal fade" id="removeModal" tabindex="-1" role="dialog" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="exampleModalLabel">Remove Package</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	        Are you sure you want to remove?
	        <div id="remove-package-alert" class="alert alert-danger d-none">Hello</div>
	      </div>
	      <div class="modal-footer">
	        <button id="remove-package-cancel" type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
	        <button id="remove-package" type="button" class="btn btn-primary">Remove</button>
	      </div>
	    </div>
	  </div>
	</div>

	<script type="text/javascript">
		
		$(document).ready(function(){

			$('.remove').on('click', function () {
			  	var modal = $('#removeModal');
			  	modal.modal('toggle');
			  	var removeButton = modal.find("#remove-package");
			  	removeButton.attr("data-package", $(this).attr("data-package"));
				removeButton.attr("data-id", $(this).attr("data-id"));
			});

			$('#remove-package').on('click', function(){
				var package = $(this).attr("data-package"), 
					button = $(this),
					package_alert= $("#remove-package-alert");
				button.prop("disabled",true);
				$.ajax({
					method: "POST",
					url: "/remove",
					contentType: "application/json",
					data: JSON.stringify({ packages: [package] }),
					complete: function(jqXHR, status){
						if(status == "error")
							package_alert.text("Error").removeClass("d-none");
						else if(status == "success"){
							package_alert.text("").addClass("d-none");
							$("#"+button.attr("data-id")).remove();
							$('#removeModal').modal("hide");
						}
						button.prop("disabled",false);
					}
				});
			});

			$("#remove-package-cancel").on('click', function(){
				$("#remove-package-alert").text("").addClass("d-none");
				$("#remove-package").prop("disabled", false);
			});


		});

	</script>

</body>

</html>